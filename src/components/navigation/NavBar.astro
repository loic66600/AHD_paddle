---
import { withBase } from '../../utils/url';

const homeLink = withBase('/');
const logoSrc = withBase('/images/logo_blanc.png');
const categories = [
	{ href: withBase('/windsurf'), label: 'Windsurf' },
	{ href: withBase('/wingfoil'), label: 'Wingfoil' },
	{ href: withBase('/accessoires'), label: 'Accessoires' }
];

const menuItems = [
	{ href: withBase('/#univers'), label: '> Univers AHD', children: categories },
	{ href: withBase('/#gamme'), label: 'Collection' },
	{ href: withBase('/#histoire'), label: 'Histoire' },
	{ href: withBase('/#decouvrir'), label: 'DÃ©couvrir' }
];
---

<div class="relative">
	<input id="ahd-drawer-toggle" type="checkbox" class="peer sr-only" aria-hidden="true" />

	<!-- Navigation principale avec menu fixe -->
	<header
		id="ahd-global-nav"
		class="nav-dark fixed inset-x-0 top-0 z-40 grid grid-cols-[auto_1fr_auto] items-center gap-4 px-6 py-5 md:px-12"
	>
		<label
			id="ahd-menu-button"
			for="ahd-drawer-toggle"
			class="nav-trigger text-sm uppercase tracking-[0.35em] focus:outline-none cursor-pointer"
			aria-controls="ahd-drawer"
			aria-expanded="false"
		>
			Menu
		</label>
		<a href={homeLink} class="nav-brand flex flex-col items-center gap-3 justify-self-center focus:outline-none">
			<img id="ahd-nav-logo" src={logoSrc} alt="AHD" class="nav-logo h-9 w-auto" loading="lazy" />
			<p class="nav-tagline text-xs uppercase tracking-[0.5em]">AHD Paddle Division</p>
		</a>
		<div class="w-16"></div>
	</header>

	<div
		id="ahd-drawer"
		class="fixed inset-y-0 left-0 z-50 w-72 max-w-xs -translate-x-full transform bg-midnight/95 px-8 py-12 transition-transform duration-500 will-change-transform overflow-visible peer-checked:translate-x-0 lg:w-[24rem] lg:max-w-none lg:px-10"
	>
		<nav class="flex flex-col gap-8 text-sm uppercase tracking-[0.35em] text-foam/80 lg:gap-10">
			{menuItems.map((item) => (
				<div class="flex flex-col gap-3 group/menu relative" role="group">
					<a href={item.href} class="flex items-center justify-between gap-4">
						<span>{item.label}</span>
						{item.children && <span aria-hidden="true" class="text-base text-foam/40 transition-transform duration-200 group-hover/menu:translate-x-1">&rarr;</span>}
					</a>
					{item.children && (
						<div class="flex flex-col gap-2 pl-5 text-xs uppercase tracking-[0.28em] text-foam/60 lg:absolute lg:inset-y-0 lg:left-full lg:top-0 lg:min-w-[280px] lg:max-w-[340px] lg:rounded-r-[3rem] lg:bg-white lg:px-12 lg:py-10 lg:text-left lg:text-[0.7rem] lg:tracking-[0.2em] lg:text-midnight/80 lg:shadow-[0_24px_60px_rgba(15,23,42,0.22)] lg:opacity-0 lg:pointer-events-none lg:transition lg:duration-200 lg:border-l lg:border-midnight/10 lg:-ml-px lg:h-full lg:group-hover/menu:opacity-100 lg:group-hover/menu:pointer-events-auto lg:group-hover/menu:translate-x-0 lg:group-focus-within/menu:opacity-100 lg:group-focus-within/menu:pointer-events-auto lg:group-focus-within/menu:translate-x-0 lg:pl-12">
							{item.children.map((child) => (
								<a href={child.href} class="flex items-center justify-between gap-3 text-foam/70 hover:text-foam lg:text-midnight lg:hover:text-midnight">
									<span>{child.label}</span>
									<span aria-hidden="true" class="text-base font-normal text-foam/50 lg:text-midnight/50">&rarr;</span>
								</a>
							))}
						</div>
					)}
				</div>
			))}
		</nav>
	</div>

	<label
		for="ahd-drawer-toggle"
		class="fixed inset-0 z-40 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300 peer-checked:opacity-100 peer-checked:pointer-events-auto"
		aria-hidden="true"
	></label>

	<script type="module">
		const drawerToggle = document.getElementById('ahd-drawer-toggle');
		const drawerLinks = document.querySelectorAll('#ahd-drawer a');
		const menuButton = document.getElementById('ahd-menu-button');

		if (drawerToggle && menuButton) {
			menuButton.setAttribute('aria-expanded', String(drawerToggle.checked));
			drawerToggle.addEventListener('change', () => {
				menuButton.setAttribute('aria-expanded', String(drawerToggle.checked));
			});
		}

		if (drawerToggle && drawerLinks.length) {
			const closeMenu = () => {
				drawerToggle.checked = false;
				if (menuButton) {
					menuButton.setAttribute('aria-expanded', 'false');
				}
			};

			drawerLinks.forEach((link) => {
				link.addEventListener('click', closeMenu);
			});
		}
	</script>
</div>
